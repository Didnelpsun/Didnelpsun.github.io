---
layout: post
title:  "Spring基础10"
date:   2020-04-01 23:30:38 +0800
categories: notes spring base
tags: spring 基础 事件
excerpt: "事件处理"
---

如我们在上一个文档说的，我们目前来说核心就是ApplicationContext，它负责管理beans的完整生命周期。当加载beans时，ApplicationContext发布某些类型的事件。例如，当上下文启动时，ContextStartedEvent发布，当上下文停止时，ContextStoppedEvent发布。

通过ApplicationEvent类和ApplicationListener接口来提供在ApplicationContext中处理事件。如果一个bean实现ApplicationListener，那么每次ApplicationEvent被发布到ApplicationContext上，那个bean会被通知。

Spring提供了以下的标准事件：

Spring内置事件|描述
:-----------:|:---
ContextRefreshedEvent|ApplicationContext被初始化或刷新时，该事件被发布。这也可以在ConfigurableApplicationContext接口中使用refresh()方法来发生。
ContextStartedEvent|当使用ConfigurableApplicationContext接口中的`start()`方法启动ApplicationContext时，该事件被发布。你可以调查你的数据库，或者你可以在接受到这个事件后重启任何停止的应用程序。
ContextStoppedEvent|当使用ConfigurableApplicationContext接口中的`stop()`方法停止ApplicationContext时，发布这个事件。你可以在接受到这个事件后做必要的清理的工作。
ContextClosedEvent|当使用ConfigurableApplicationContext接口中的`close()`方法关闭ApplicationContext时，该事件被发布。一个已关闭的上下文到达生命周期末端；它不能被刷新或重启。
RequestHandledEvent|这是一个web-specific事件，告诉所有bean，HTTP请求已经被服务。

由于Spring的事件处理是单线程的，所以如果一个事件被发布，直至并且除非所有的接收者得到的该消息，该进程被阻塞并且流程将不会继续。因此，如果事件处理被使用，在设计应用程序时应注意。

## &emsp;监听上下文事件

为了监听上下文事件，一个bean应该实现只有一个方法`onApplicationEvent()`的ApplicationListener接口，不然会出错。因此，我们写一个例子来看看事件是如何传播的，以及如何可以用代码来执行基于某些事件所需的任务。

