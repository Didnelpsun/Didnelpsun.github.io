---
layout: post
title:  "Spring基础5"
date:   2020-03-23 17:17:09 +0800
categories: notes spring base
tags: spring 基础
excerpt: "依赖注入"
---

我们在创建Spring Bean的时候就已经使用过了依赖注入的概念，但是我们一直都没有仔细的系统的去讲。依赖注入分为两种大的方式，一种是基于注释，一种是基于xml配置。

每个基于应用程序的Java都有几个对象，这些对象一起工作来呈现出终端用户所看到的工作的应用程序。当编写一个复杂的Java应用程序时，应用程序类应该尽可能独立于其他Java类来增加这些类重用的可能性，并且在做单元测试时，测试独立于其他类的独立性。依赖注入（或有时称为布线）有助于把这些类粘合在一起，同时保持他们独立。

那么重新来看，什么是依赖注入？注入的是<span style="color:orange">依赖的类</span>，而不是值！如果是注入值，应该被初始化值，那么可以使用xml的property标签。但是如果是依赖注入，那么就不能这么做。

```java
//新建一个Didnelpsun类
public class Didnelpsun{
    //拥有一个私有变量，类型为blog，代表为博客类
    private Blog DidBlog;
    public Didnelpsun(){
        //构造函数中新建一个blog类来赋值给Didnelpsun属性
        DidBlog = new Blog();
    }
}
//这是基本的实现，那么我们如果使用依赖注入的方式来实现呢？
public class Didnelpsun{
    private Blog DidBlog;
    public Didnelpsun(Blog DidBlog){
        this.DidBlog = DidBlog;
    }
}
```

为了控制反转和依赖注入，我们将初始化一个Blog类的的过程从构造函数中移除，而将这个功能交给传入的参数，构造方法不关心这个类是如何构造的。在控制反转中这个类将由容器构造并赋值给这个属性。这就是依赖注入。

我们可能会奇怪构造函数中第一个的DidBlog为什么没有指明this，是因为DidBlog这个属性在第一个构造方法中是独有的，而第二个构造方法中参数和类属性重名了，所以必须指明this，虽然我们也可以不重名，但是并不推荐这样使用，因为并不直观。

首先还是利用[Spring项目模板文件：spring/spring](https://github.com/Didnelpsun/notes/tree/master/spring/spring)来构建示例项目。

## 构造器注入

首先我们还是按照构造一个User类，然后User类调用HelloWorld类的思路来举例子：

```java
//User.java
package org.didnelpsun.test;

public class User {
    private HelloWorld helloWorld;
    public User(HelloWorld helloWorld){
        this.helloWorld = helloWorld;
        System.out.println("Start building User class...");
    }
    public void SayHello(){
        helloWorld.SayHello();
    }
}
```

我们来分析一下这个例子。首先我们主要的类是User类，它有一个私有属性是HelloWorld类型的。然后我们使用User的构造器来初始化这个类，它按照依赖注入的概念不在构造函数中创建类，而是使用一个参数引入，然后把参数赋值给类的属性，再打印。User类还有一个方法SayHello，这个方法是调用HelloWrold类的方法。

```java
//HelloWorld.java
package org.didnelpsun.test;

public class HelloWorld {
    public HelloWorld(){
        System.out.println("Start building HelloWorld class");
    }
    public void SayHello(){
        System.out.println("Hello,World!");
    }
}
```

然后再看HelloWorld类，它也有一个只打印的构造方法和一个SayHello方法。

```java
//App.java
package org.didnelpsun;
import org.didnelpsun.test.User;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class App
{
    private static ApplicationContext welcomeContext;
    public static void main(String args[]){
        welcomeContext = new ClassPathXmlApplicationContext("SpringBeans.xml");
        User Didnelpsun = (User) welcomeContext.getBean("Didnelpsun");
        Didnelpsun.SayHello();
    }
}
```

主类就是获取一个名为Didnelpsun的实例，这个实例对应的是User类实例化的，然后调用它的SayHello方法。这里我们要关注到一个细节，虽然User类中的构造器中需要传入一个依赖的类HelloWorld，但是在主类中它并没有表现出传入这个参数。

如在开头所说的，在之前的案例中，如果要传入实例的值，如String类型的打印需要的字符串，需要在xml的property属性标签中配置，那依赖注入是否也是如此呢？

```xml
<bean id="HelloWorld" class="org.didnelpsun.test.HelloWorld"/>
<bean id="Didnelpsun" class="org.didnelpsun.test.User">
    <constructor-arg ref="HelloWorld"/>
</bean>
```

我们可以在这里看出细节，在xml中首先定义一个HelloWorld的实例，也就是说已经实例化一个名为HelloWorld的HelloWorld类实例了，并把它放在实例池中，然后实例化名为Didnelpsun的User类，因为User类需要传入依赖的HelloWorld类，所以使用<span style="color:orange">\<constructor-arg/>标签</span>，并使用<span style="color:orange">ref</span>属性确定依赖类的实例名，来自动注入依赖的实例，也就是从实例池中取出实例化好了的实例。包括实例化以及注入依赖实例，这些都是在Spring容器中自动完成的，这就是依赖注入，也是一种控制反转。

![result1][result1]



[result1]:data:image/png;base64,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

[]