---
layout: post
title:  "react基础3"
date:   2019-05-18 23:12:56 +0800
categories: notes react
tags: react 基础 3 state 生命周期 componentDidMount componentWillUnmount
excerpt: "状态与生命周期"
---

## 状态

### &emsp;1.状态的含义

官方网中给了时钟的示例，不过无论是时钟还是别的组件，都可以有状态。状态是什么？就是组件自身的数据，不是依靠外部传入的，可以改变的，而不像props一样不能被改变的。

那为什么要使用状态？就是组件化的思想，将逻辑封装到各个组件。就比如时钟，时钟本来就是应该依靠时间而改变数据的而不是依靠外面参数而改变的，所以就将数据放在组件里面。又如一个记录点赞数的面板，点赞数是这个面板本身的数据，点击组件发生改变，每个面板数据不一样，不是依赖父组件给它传递的数据而改变，那么这个面板就是一个有状态的组件。

组件的状态就是`this.state`。但是状态不能直接使用，不像参数，需要首先构造组件。

<font color="aqua">格式：</font>

```javascript
class 组件名 extends React.Component {
  constructor(props) {
    super(props);
    this.state = { state的内容 };
  }

  render() {
    return (
      <返回元素>
      {this.state}
      <返回元素>
    );
  }
}
```

constructor就是构造器，传入参数，因为这些组件都是由`react.component`继承下来的，如果我们要使用状态首先要构造该组件，所以加上了constructor，并传入参数，我们知道如果要实例化组件，必须首先实例化父组件，即`react.component`，使用`super(props)`来构造父组件，然后就是赋值state，因为是本组件的状态就是`this.state`。

### &emsp;2.使用状态

#### &emsp;&emsp;2.1setState()方法

首先状态的更改使用不能直接赋值，只能使用setState()方法。且赋值也不是使用等号，而是使用对象的方式进行重新赋值。如：`this.setState({age:"1"})`

#### &emsp;&emsp;2.2异步更新

因为this.state的改变会因为setState()的更新是合并的，所以会异步更新，从而和this.props不对应，处理方法就是将state和props同时传入setState()方法中：
`this.setState((state,props)=>({变量:值}));`

```javascript
this.setState((state, props) => ({
  counter: state.counter + props.increment
}));


this.setState(function(state, props) {
  return {
    counter: state.counter + props.increment
  };
});
```

#### &emsp;&emsp;2.3数据单向

之前说过react本身是一个单向数据流的mvc框架而不是mvvc框架，所以它的数据都是不断向下的而不是向上的或者是双向的，所以我们可以将父组件的state以参数的形式传入子组件中。如：`<FormattedDate date={this.state.date} />`

## 生命周期函数

生命周期函数有两个，在组件定义中应该放在constructor()函数和自定义函数之间，render()函数放在最后面。

componentDidMount()代表组件已经挂载完毕。

componentDidUpdate()代表组件已经更新。

componentWillUnmount()代表组件即将取消挂载。

使用生命周期函数的原因就是为了节省资源，使用该组件就占用资源，组件被销毁就释放资源。
