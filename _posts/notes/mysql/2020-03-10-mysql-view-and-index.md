---
layout: post
title:  "视图与索引"
date:   2020-03-10 17:30:49 +0800
categories: notes mysql base
tags: MySQL 基础 mysql 重命名 查看 更新 视图 创建 索引
excerpt: "视图与索引"
---

## 视图

视图定义中不能引用 TEMPORARY 表（临时表），不能创建 TEMPORARY 视图。

### &emsp;重命名

<span style="color:aqua">格式：</span>`RENAME TABLE 视图名 TO 新视图名;`

### &emsp;查看

查看视图<span style="color:aqua">格式：</span>`DESCRIBE 视图名;`

DESCRIBE 一般情况下可以简写成 DESC，输入这个命令的执行结果和输入 DESCRIBE 是一样的。

### &emsp;更新

视图是一个虚拟表，实际的数据来自于基本表，所以通过插入、修改和删除操作更新视图中的数据，实质上是在更新视图所引用的基本表的数据。对视图的修改就是对基本表的修改，因此在修改时，要满足基本表的数据定义。

某些视图是可更新的。也就是说，可以使用 UPDATE、DELETE 或 INSERT 等语句更新基本表的内容。对于可更新的视图，视图中的行和基本表的行之间必须具有一对一的关系。

还有一些特定的其他结构，这些结构会使得视图不可更新。更具体地讲，如果视图包含以下结构中的任何一种，它就是不可更新的：

+ 聚合函数 SUM()、MIN()、MAX()、COUNT() 等。
+ DISTINCT 关键字。
+ GROUP BY 子句。
+ HAVING 子句。
+ UNION 或 UNION ALL 运算符。
+ 位于选择列表中的子查询。
+ FROM 子句中的不可更新视图或包含多个表。
+ WHERE 子句中的子查询，引用 FROM 子句中的表。
+ ALGORITHM 选项为 TEMPTABLE（使用临时表总会使视图成为不可更新的）的时候。

&emsp;

## 索引

### &emsp;1. 索引的分类

索引的类型和存储引擎有关，每种存储引擎所支持的索引类型不一定完全相同。根据存储方式的不同，MySQL 中常用的索引在物理上分为以下两类。

#### &emsp;&emsp;B-树索引

B-树索引又称为 BTREE 索引，目前大部分的索引都是采用 B-树索引来存储的。B-树索引是一个典型的数据结构，其包含的组件主要有以下几个：  
叶子节点：包含的条目直接指向表里的数据行。叶子节点之间彼此相连，一个叶子节点有一个指向下一个叶子节点的指针。  
分支节点：包含的条目指向索引里其他的分支节点或者叶子节点。
根节点：一个 B-树索引只有一个根节点，实际上就是位于树的最顶端的分支节点。

基于这种树形数据结构，表中的每一行都会在索引上有一个对应值。因此，在表中进行数据查询时，可以根据索引值一步一步定位到数据所在的行。

B-树索引可以进行全键值、键值范围和键值前缀查询，也可以对查询结果进行 ORDER BY 排序。但 B-树索引必须遵循左边前缀原则，要考虑以下几点约束：  
查询必须从索引的最左边的列开始。  
查询不能跳过某一索引列，必须按照从左到右的顺序进行匹配。  
存储引擎不能使用索引中范围条件右边的列。  

#### &emsp;&emsp;哈希索引

哈希（Hash）一般翻译为"散列"，也有直接音译成"哈希"的，就是把任意长度的输入（又叫作预映射，pre-image）通过散列算法变换成固定长度的输出，该输出就是散列值。

哈希索引也称为散列索引或 HASH 索引。MySQL 目前仅有 MEMORY 存储引擎和 HEAP 存储引擎支持这类索引。其中，MEMORY 存储引擎可以支持 B- 树索引和 HASH 索引，且将 HASH 当成默认索引。

HASH 索引不是基于树形的数据结构查找数据，而是根据索引列对应的哈希值的方法获取表的记录行。哈希索引的最大特点是访问速度快，但也存在下面的一些缺点：  
MySQL 需要读取表中索引列的值来参与散列计算，散列计算是一个比较耗时的操作。也就是说，相对于 B- 树索引来说，建立哈希索引会耗费更多的时间。  
不能使用 HASH 索引排序。  
HASH 索引只支持等值比较，如"=""IN()"或"<=>"。  
HASH 索引不支持键的部分匹配，因为在计算 HASH 值的时候是通过整个索引值来计算的。

根据索引的具体用途，MySQL 中的索引在逻辑上分为以下5类：

1) 普通索引  
普通索引是最基本的索引类型，唯一任务是加快对数据的访问速度，没有任何限制。创建普通索引时，通常使用的关键字是 INDEX 或 KEY。  

2) 唯一性索引  
唯一性索引是不允许索引列具有相同索引值的索引。如果能确定某个数据列只包含彼此各不相同的值，在为这个数据列创建索引的时候就应该用关键字 UNIQUE 把它定义为一个唯一性索引。创建唯一性索引的目的往往不是为了提高访问速度，而是为了避免数据出现重复。  

3) 主键索引  
主键索引是一种唯一性索引，即不允许值重复或者值为空，并且每个表只能有一个主键。主键可以在创建表的时候指定，也可以通过修改表的方式添加，必须指定关键字 PRIMARY KEY。  
<span style="color:orange">注意：</span>主键是数据库考察的重点。注意每个表只能有一个主键。  

4) 空间索引  
空间索引主要用于地理空间数据类型 GEOMETRY。  

5) 全文索引  
全文索引只能在 VARCHAR 或 TEXT 类型的列上创建，并且只能在 MyISAM 表中创建。

索引在逻辑上分为以上 5 类，但在实际使用中，索引通常被创建成单列索引和组合索引。
单列索引就是索引只包含原表的一个列。
组合索引也称为复合索引或多列索引，相对于单列索引来说，组合索引是将原表的多个列共同组成一个索引。
提示：一个表可以有多个单列索引，但这些索引不是组合索引。一个组合索引实质上为表的查询提供了多个索引，以此来加快查询速度。比如，在一个表中创建了一个组合索引(c1，c2，c3)，在实际查询中，系统用来实际加速的索引有三个：单个索引(c1)、双列索引(c1，c2)和多列索引(c1，c2，c3)。

为了提高索引的应用性能，MySQL中的索引可以根据具体应用采用不同的索引策略。这些索引策略所对应的索引类型有聚集索引、次要索引、覆盖索引、复合索引、前缀索引、唯一索引等。

### &emsp;2. 创建

#### &emsp;&emsp;2.1CREATE INDEX

<span style="color:aqua">格式：</span>`CREATE 索引名 ON 表名 (列1,列2... 长度 ASC | DESC)`

长度为可选项。指定使用列前的 length 个字符来创建索引。使用列的一部分创建索引有利于减小索引文件的大小，节省索引列所占的空间。在某些情况下，只能对列的前缀进行索引。索引列的长度有一个最大上限 255 个字节（MyISAM 和 InnoDB 表的最大上限为 1000 个字节），如果索引列的长度超过了这个上限，就只能用列的前缀进行索引。另外，BLOB 或 TEXT 类型的列也必须使用前缀索引。

#### &emsp;&emsp;2.2CREATE TABLE

在创建新表的同时创建该表的主键<span style="color:aqua">格式：</span>`CONSTRAINT PRIMARY KEY 索引类型 (列1,列2...)`索引类型可选。

在创建新表的同时创建该表的索引<span style="color:aqua">格式：</span>`KEY | INDEX 索引名 索引类型 (列1,列2...)`索引类型和索引名可选。

在创建新表的同时创建该表的唯一性索引<span style="color:aqua">格式：</span>`UNIQUE  INDEX | KEY 索引名 索引类型 (列1,列2...)`索引类型和索引名可选。

在创建新表的同时创建该表的外键<span style="color:aqua">格式：</span>`FOREIGN KEY 索引名 列名`

#### &emsp;&emsp;2.3ALTER TABLE

修改表的同时为该表添加索引<span style="color:aqua">格式：</span>`ADD INDEX 索引名 索引类型 (列1,列2...)`索引类型和索引名可选。

在修改表的同时为该表添加主键<span style="color:aqua">格式：</span>`ADD PRIMARY KEY 索引类型 (列1,列2...)`索引类型可选。

在修改表的同时为该表添加唯一性索引<span style="color:aqua">格式：</span>`ADD UNIQUE INDEX | KEY 索引名 索引类型 (列1,列2...)`索引类型和索引名可选。

在修改表的同时为该表添加外键<span style="color:aqua">格式：</span>`ADD FOREIGN KEY 索引名 (列1,列2...)`索引名可选。
