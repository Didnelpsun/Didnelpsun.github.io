---
layout: post
title:  "MySQL基础10"
date:   2020-03-08 20:03:06 +0800
categories: notes mysql base
tags: mysql MySQL 基础 
excerpt: "存储过程与自定义函数"
---

## 存储过程

存储过程是对于一套语句的集合，为了解决一套问题。

使用存储过程的目的是将常用或复杂的工作预先用 SQL 语句写好并用一个指定名称存储起来，这个过程经编译和优化后存储在数据库服务器中，因此称为存储过程。当以后需要数据库提供与已定义好的存储过程的功能相同的服务时，只需调用"CALL存储过程名字"即可自动完成。

常用操作数据库的 SQL 语句在执行的时候需要先编译，然后执行。存储过程则采用另一种方式来执行 SQL 语句。

一个存储过程是一个可编程的函数，它在数据库中创建并保存，一般由 SQL 语句和一些特殊的控制结构组成。当希望在不同的应用程序或平台上执行相同的特定功能时，存储过程尤为合适。

存储过程通常有如下优点：  
1) 封装性  
存储过程被创建后，可以在程序中被多次调用，而不必重新编写该存储过程的 SQL 语句，并且数据库专业人员可以随时对存储过程进行修改，而不会影响到调用它的应用程序源代码。  
2) 可增强 SQL 语句的功能和灵活性  
存储过程可以用流程控制语句编写，有很强的灵活性，可以完成复杂的判断和较复杂的运算。  
3) 可减少网络流量  
由于存储过程是在服务器端运行的，且执行速度快，因此当客户计算机上调用该存储过程时，网络中传送的只是该调用语句，从而可降低网络负载。  
4) 高性能  
存储过程执行一次后，产生的二进制代码就驻留在缓冲区，在以后的调用中，只需要从缓冲区中执行二进制代码即可，从而提高了系统的效率和性能。  
5) 提高数据库的安全性和数据的完整性  
使用存储过程可以完成所有数据库操作，并且可以通过编程的方式控制数据库信息访问的权限。

### &emsp;1. 创建



&emsp;

## 自定义函数

在使用 MySQL 的过程中，MySQL 自带的函数可能完成不了我们的业务需求，这时候就需要自定义函数。

自定义函数是一种与存储过程十分相似的过程式数据库对象。它与存储过程一样，都是由 SQL 语句和过程式语句组成的代码片段，并且可以被应用程序和其他 SQL 语句调用。

自定义函数与存储过程之间存在几点区别：

+ 自定义函数不能拥有输出参数，这是因为自定义函数自身就是输出参数；而存储过程可以拥有输出参数。
+ 自定义函数中必须包含一条 RETURN 语句，而这条特殊的 SQL 语句不允许包含于存储过程中。
+ 可以直接对自定义函数进行调用而不需要使用 CALL 语句，而对存储过程的调用需要使用 CALL 语句。

### &emsp;创建与使用

一般使用`CREATE FUNCTION`，<span style="color:aqua">格式：</span>

```sql
CREATE FUNCTION <函数名> (参数1 类型1, 参数2 类型2...)
RETURNS 类型
函数主体
```

+ 自定义函数不能与存储过程具有相同的名称。
+ 参数只有名称和类型，不能指定关键字 IN、OUT 和 INOUT。
+ RETURNS 类型 用于声明自定义函数返回值的数据类型。其中，类型用于指定返回值的数据类型。
+ 函数体。所有在存储过程中使用的 SQL 语句在自定义函数函数体中同样适用，包括前面所介绍的局部变量、SET 语句、流程控制语句、游标等。除此之外，自定义函数体还必须包含一个 RETURN 值 语句，其中 值 用于指定自定义函数的返回值。
+ 在 RETURN VALUE 语句中包含 SELECT 语句时，SELECT 语句的返回结果只能是一行且只能有一列值。
+ 若要查看数据库中存在哪些自定义函数，可以使用 `SHOW FUNCTION STATUS` 语句；若要查看数据库中某个具体的自定义函数，可以使用 `SHOW CREATE FUNCTION 函数名` 语句，其中<函数名>用于指定该自定义函数的名称。
