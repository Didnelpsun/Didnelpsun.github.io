---
layout: post
title:  "sql基础2"
date:   2019-07-03 15:40:03 +0800
categories: notes sql base
tags: sql SQL 语法
excerpt: "语法"
---

首先需要<span style="color:orange">注意</span>的是sql语法对于大小写不敏感。

可以把 SQL 分为两个部分：数据操作语言 (DML) 和 数据定义语言 (DDL)。
SQL (结构化查询语言)是用于执行查询的语法。但是 SQL 语言也包含用于更新、插入和删除记录的语法。

查询和更新指令构成了 SQL 的 DML 部分：

+ SELECT - 从数据库表中获取数据
+ UPDATE - 更新数据库表中的数据
+ DELETE - 从数据库表中删除数据
+ INSERT INTO - 向数据库表中插入数据

SQL 的数据定义语言 (DDL) 部分使我们有能力创建或删除表格。我们也可以定义索引（键），规定表之间的链接，以及施加表间的约束。

SQL 中最重要的 DDL 语句:

+ CREATE DATABASE - 创建新数据库
+ ALTER DATABASE - 修改数据库
+ CREATE TABLE - 创建新表
+ ALTER TABLE - 变更（改变）数据库表
+ DROP TABLE - 删除表
+ CREATE INDEX - 创建索引（搜索键）
+ DROP INDEX - 删除索引

<span style="color:red">警告！</span>SQL中的值如果是字符串需要使用英文单引号括起来，而数值不需要且不能。

## DML基础操作

### &emsp;1. 查询

#### &emsp;&emsp;1.1SELECT和FROM

SELECT 语句用于从表中选取数据。结果被存储在一个结果表中（称为结果集）。

<span style="color:aqua">格式：</span>`SELECT 列名1,列名2... FROM 表名称` / `SELECT * FROM 表名称`（*代表全部）

#### &emsp;&emsp;1.2DISTINCT

在表中，可能会包含重复值。关键词 DISTINCT 用于返回唯一不同的值。

<span style="color:aqua">格式：</span>`SELECT DISTINCT 列名1,列名2... FROM 表名称`

#### &emsp;&emsp;1.3WHERE

如需有条件地从表中选取数据，可将 WHERE 子句添加到 SELECT 语句。

<span style="color:aqua">格式：</span>`SELECT 列名1,列名2... FROM 表名称 WHERE 列 运算符 值`

运算符包括算术运算符、比较运算符等之前提到的所有运算符。

#### &emsp;&emsp;1.4AND和OR

AND 和 OR 可在 WHERE 子语句中把两个或多个条件结合起来。

如果第一个条件和第二个条件都成立，则 AND 运算符显示一条记录。

如果第一个条件和第二个条件中只要有一个成立，则 OR 运算符显示一条记录。

<span style="color:aqua">格式：</span>`SELECT 列名1,列名2... FROM 表名称 WHERE 式子1 AND 式子2...` / `SELECT 列名1,列名2... FROM 表名称 WHERE 式子1 OR 式子2...`

#### &emsp;&emsp;1.5ORDER BY

ORDER BY 语句用于根据指定的列（即对应的属性名）对结果集进行排序。默认按照升序对记录进行排序。如果您希望按照降序对记录进行排序，可以使用 DESC 关键字。（如果是顺序就是ASC关键字）

<span style="color:aqua">格式：</span>`SELECT 列名1,列名2... FROM 表名称 ORDER BY 表中属性名1 ASC/DESC,表中属性名2 ASC/DESC...`

### &emsp;2. 插入

INSERT INTO 语句用于向表格中插入新的行或列。

<span style="color:aqua">格式：</span>`INSERT INTO 表名称 VALUES (值1, 值2,....)` \ `INSERT INTO 表名称 (列1, 列2,...) VALUES (值1, 值2...)`

### &emsp;3. 更新

<span style="color:aqua">格式：</span>`UPDATE 表名称 SET 列名称 = 新值 WHERE 列名称 = 某值`

### &emsp;4. 删除

<span style="color:aqua">格式：</span>`DELETE FROM 表名称 WHERE 列名称 = 值`

如果删除全部表<span style="color:aqua">格式：</span>`DELETE FROM 表名称` / `DELETE * FROM 表名称`

&emsp;

## DDL基础操作

### &emsp;1. 创建

#### &emsp;&emsp;1.1CREATER DATABASE

用于创建数据库。

<span style="color:aqua">格式：</span>`CREATER DATABASE 数据库名`

#### &emsp;&emsp;1.2CREATE TABLE

用于创建数据库中的表。

<span style="color:aqua">格式：</span>

```sql
CREATE TABLE 表名称
(
列名称1 数据类型,
列名称2 数据类型,
列名称3 数据类型,
...
)
```

数据类型|描述
:-----:|:---
integer(size)/int(size)/smallint(size)/tinyint(size)|仅容纳整数。在括号内规定数字的最大位数。
decimal(size,d)/numeric(size,d)|容纳带有小数的数字。"size" 规定数字的最大位数。"d" 规定小数点右侧的最大位数。
char(size)|容纳固定长度的字符串（可容纳字母、数字以及特殊字符）。在括号中规定字符串的长度。
varchar(size)|容纳可变长度的字符串（可容纳字母、数字以及特殊的字符）。在括号中规定字符串的最大长度。
date(yyyymmdd)|容纳日期。

#### &emsp;&emsp;1.3CREATE INDEX

用于在表中创建索引。在不读取整个表的情况下，索引使数据库应用程序可以更快地查找数据。<span style="color:orange">注意：</span>用户无法看到索引，它们只能被用来加速搜索/查询。

<span style="color:yellow">提示：</span>更新一个包含索引的表需要比更新一个没有索引的表花费更多的时间，这是由于索引本身也需要更新。因此，理想的做法是仅仅在常常被搜索的列（以及表）上面创建索引。

<span style="color:aqua">格式：</span>`CREATE INDEX 索引名 ON 表名 (列名1 ASC/DESC,列名2 ASC/DESC...)`

一般我们的索引值不允许有重复的数值，所以应该加上UNIQUE关键字：`CREATE UNIQUE INDEX 索引名 ON 表名 (列名)`。对于UNIQUE关键字稍后再具体讲解。

### &emsp;2. 更改

ALTER TABLE 语句用于在已有的表中添加、修改或删除列。关于ADD、DROP关键字后面会仔细谈到。

#### &emsp;&emsp;2.1添加列

<span style="color:aqua">格式：</span>`ALTER TABLE 表名 ADD 列名 数据类型`

#### &emsp;&emsp;2.2删除列

<span style="color:aqua">格式：</span>`ALTER TABLE 表名 DROP 列名 数据类型`

#### &emsp;&emsp;2.3修改数值类型

<span style="color:aqua">格式：</span>`ALTER TABLE 表名 ALTER COLUMN 列名 数据类型`

#### &emsp;&emsp;2.4修改数据库

<span style="color:aqua">格式：</span>`ALTER DATABASE 数据库名`

这个语句比较复杂，且对于初学并不会用到。

### &emsp;3. 删除

#### &emsp;&emsp;3.1DROP INDEX

用于删除表中的索引。

<span style="color:aqua">格式：</span>

+ MS Access：`DROP INDEX 索引名 ON 表名`
+ MS SQL Server：`DROP INDEX 表名.索引名`
+ DB2/Oracle：`DROP INDEX 索引名`
+ MySQL：`ALTER TABLE 表名 DROP INDEX 索引名`

#### &emsp;&emsp;3.2DROP TABLE

用于删除表。

<span style="color:aqua">格式：</span>`DROP TABLE 表名`

#### &emsp;&emsp;3.3DROP DATABASE

删除数据库。

<span style="color:aqua">格式：</span>`DROP DATABASE 数据库名`

#### &emsp;&emsp;3.4TRUNCATE TABLE

删除表内的数据，但并不删除表本身。

<span style="color:aqua">格式：</span>`TRUNCATE TABLE 表名`

&emsp;

## 高级语法

### &emsp;1. 分页与限制

规定要返回的记录的数目。SELECT LIMIT子句对于拥有数千条记录的大型表来说，是非常有用的。

<span style="color:orange">注意：</span>并非所有的数据库系统都支持 SELECT TOP 语句。 MySQL 支持 LIMIT 语句来选取指定的条数数据， Oracle 可以使用 ROWNUM 来选取。下面的列名就代表只显示前多少行，如果是1就是只显示一行，如果是0就显示全部。

+ SQL Server / MS Access<span style="color:aqua">格式：</span>`SELECT TOP 列数|百分比 列1, 列2... FROM 表名;`
+ MySQL<span style="color:aqua">格式：</span>`SELECT 列1, 列2... FROM 表名 LIMIT 列数;`
+ Oracle<span style="color:aqua">格式：</span>`SELECT 列1, 列2... FROM 表名 WHERE ROWNUM <= 列数;`

```sql
--SQL Server / MS Access--
SELECT TOP 5 PERCENT *
FROM Websites;
--MySQL--
SELECT *
FROM Persons
LIMIT 5;
--Oracle--
SELECT *
FROM Persons
WHERE ROWNUM <=5;
```

如果想选择最后几行只用先将表格反序就行——order by 列名 desc。

如果想获取一定范围内的数据，请使用<span style="color:aqua">格式：</span>`LIMIT 列数 OFFSET 偏移量`的格式的OFFSET关键字，这将获取偏移量~偏移量+列数的数据，数据从0开始排序。

也是说如果是：

```sql
SELECT *
FROM Persons
LIMIT 5 OFFSET 1;
```

就说明它将从第二行数据开始截取获取5条数据，即从第二到第六条数据。

### &emsp;2. 匹配

LIKE 操作符用于在 WHERE 子句中搜索列中的指定模式。

<span style="color:aqua">格式：</span>`SELECT 列1, 列2... FROM 表名 WHERE 列名 LIKE 模式`

或者使用了NOT关键字的<span style="color:aqua">格式：</span>`SELECT 列1, 列2... FROM 表名 WHERE 列名 NOT LIKE 模式`

```sql
--"%" 可用于定义通配符（模式中缺少的字母）。--
--将从persons表中取city属性中数值以N开头的数据--
SELECT * FROM Persons
WHERE City LIKE 'N%'
--将从persons表选取city属性中数值含有lon的数据--
SELECT * FROM Persons
WHERE City LIKE '%lon%'
```

我们这个案例使用了%做通配符，这是什么？在搜索数据库中的数据时，SQL 通配符可以替代一个或多个字符。SQL通配符必须与 LIKE 运算符一起使用。

通配符|描述
%|替代一个或多个字符
_|仅替代一个字符
[字符列]|字符列中的任何单一字符
[^字符列] / [!字符列]|不在字符列中的任何单一字符

```sql
--将从persons表选取city属性中数值以 "A" 或 "L" 或 "N" 开头数据--
SELECT * FROM Persons
WHERE City LIKE '[ALN]%'
--将从persons表选取city属性中数值不以 "A" 或 "L" 或 "N" 开头数据--
SELECT * FROM Persons
WHERE City LIKE '[!ALN]%'
```
